---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Hero from '../components/Hero.astro';
import FormattedDate from '../components/FormattedDate.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import { getAllPostSummaries } from '../lib/blog-data';
import type { BlogPostSummary } from '../lib/blog-data';


const posts: BlogPostSummary[] = (await getAllPostSummaries()).sort(
	(a, b) => b.pubDate.valueOf() - a.pubDate.valueOf()
);
const latestPosts = posts.slice(0, 3);

const categorySections = [
	{
		id: 'programming',
		title: 'プログラミング言語の最新トレンドと技術情報',
		description:
			'効率的なコーディングを可能にするヒントやチュートリアル、注目すべき言語・フレームワークの動向をピックアップ。',
		image: 'https://images.unsplash.com/photo-1517430816045-df4b7de11d1d?auto=format&fit=crop&w=1600&q=80',
		href: '/blog#programming',
		label: 'PROGRAMMING',
	},
	{
		id: 'telework',
		title: 'テレワークをより豊かにするライフスタイル提案',
		description:
			'自宅の環境づくりやチームコラボレーション術など、リモートワークを快適にする工夫を紹介。',
		image: 'https://images.unsplash.com/photo-1483478550801-ceba5fe50e8e?auto=format&fit=crop&w=1600&q=80',
		href: '/blog#telework',
		label: 'TELEWORK',
	},
	{
		id: 'skills',
		title: 'キャリアアップのための情報',
		description:
			'スキルの棚卸しから転職活動、フリーランス準備まで。市場価値を高める学びと戦略を解説。',
		image: 'https://images.unsplash.com/photo-1461749280684-dccba630e2f6?auto=format&fit=crop&w=1600&q=80',
		href: '/blog#skills',
		label: 'SKILLS',
	},
];

const postsByCategory: Record<string, BlogPostSummary[]> = Object.fromEntries(
	categorySections.map((category) => [
		category.id,
		posts.filter((post) => post.category === category.id).slice(0, 2),
	])
);
---

<!doctype html>
<html lang="ja">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<Hero />
		<main class="-mt-12 space-y-24 md:-mt-16 md:space-y-28">
			<section id="information" class="grid gap-12 md:grid-cols-[minmax(0,360px)_1fr] md:items-start">
				<div class="space-y-4">
					<p class="font-display text-sm uppercase tracking-[0.4em] text-brand-text/60">Information</p>
					<h2 class="font-display text-4xl font-semibold tracking-[0.12em] text-brand-text">お知らせ</h2>
					<p class="text-sm leading-7 tracking-[0.1em] text-brand-text/80">
						最新の記事やイベント、技術ニュースをピックアップしてお届けします。
					</p>
					<a class="cta-link w-fit" href="/blog">お知らせ一覧</a>
				</div>
				<div class="space-y-6">
					<ul class="space-y-6">
						{latestPosts.map((post) => (
							<li class="border-b border-brand-text/10 pb-6 last:border-none last:pb-0">
								<p class="text-xs uppercase tracking-[0.2em] text-brand-text/50">
									<FormattedDate date={post.pubDate} />
								</p>
								<a
									href={`/blog/${post.slug}/`}
									class="mt-2 block text-lg font-semibold tracking-[0.06em] text-brand-text transition hover:text-brand-text/70"
								>
									{post.title}
								</a>
								<p class="mt-2 text-sm leading-relaxed tracking-[0.08em] text-brand-text/70">
									{post.description}
								</p>
							</li>
						))}
					</ul>
				</div>
			</section>

			{categorySections.map((section, index) => {
				const categoryPosts = postsByCategory[section.id] ?? [];
				const isEven = index % 2 === 1;
				return (
					<section
						id={section.id}
						class:list={[
							'relative overflow-hidden rounded-3xl bg-brand-background/70 p-8 shadow-xl-soft md:p-12',
							{ 'md:bg-gradient-to-r md:from-[#f5f5f5] md:to-white': index === 0 },
						]}
					>
						<div
							class:list={[
								'grid gap-10 md:gap-14',
								{ 'md:grid-cols-[1fr_minmax(0,360px)]': !isEven },
								{ 'md:grid-cols-[minmax(0,360px)_1fr]': isEven },
							]}
						>
							<div class:list={['relative overflow-hidden rounded-2xl shadow-lg-soft', { 'md:order-last': !isEven }]}
							>
								<img
									src={section.image}
									alt={section.title}
									class="h-full w-full object-cover"
									loading="lazy"
								/>
							</div>
							<div class="space-y-6">
								<p class="font-display text-sm uppercase tracking-[0.4em] text-brand-text/60">{section.label}</p>
								<h3 class="font-display text-3xl font-semibold leading-[1.4] tracking-[0.12em] text-brand-text">
									{section.title}
								</h3>
								<p class="text-sm leading-7 tracking-[0.1em] text-brand-text/80">
									{section.description}
								</p>
								{categoryPosts.length > 0 && (
									<ul class="space-y-3">
										{categoryPosts.map((post) => (
											<li class="flex items-start gap-4">
												<span class="text-xs uppercase tracking-[0.2em] text-brand-text/50">
													<FormattedDate date={post.pubDate} />
												</span>
												<a
													href={`/blog/${post.slug}/`}
													class="text-sm font-medium tracking-[0.06em] text-brand-text transition hover:text-brand-text/70"
												>
													{post.title}
												</a>
											</li>
										))}
									</ul>
								)}
								<a class="cta-link w-fit" href={section.href}>もっと見る</a>
							</div>
						</div>
					</section>
				);
			})}
		</main>
		<Footer />
	</body>
</html>
