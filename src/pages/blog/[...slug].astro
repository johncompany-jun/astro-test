---
import BlogPost from '../../layouts/BlogPost.astro';
import { getBlogDetail, getBlogSlugs, type BlogPostDetail } from '../../lib/blog-data';

export async function getStaticPaths() {
	const slugs = await getBlogSlugs();
	const paths = await Promise.all(
		slugs.map(async (slug) => ({
			params: { slug },
			props: { detail: await getBlogDetail(slug) },
		}))
	);

	return paths;
}

interface Props {
	detail: BlogPostDetail;
}

const { detail } = Astro.props;

let contentHtml: string | null = null;
let Content: any = null;
let title: string;
let description: string;
let pubDate: Date;
let updatedDate: Date | null;
let heroImage: string | null;

if (detail.source === 'microcms') {
	contentHtml = detail.contentHtml;
	title = detail.title;
	description = detail.description;
	pubDate = detail.pubDate;
	updatedDate = detail.updatedDate;
	heroImage = detail.heroImage;
} else {
	const { entry } = detail;
	const rendered = await entry.render();
	Content = rendered.Content;
	title = entry.data.title;
	description = entry.data.description;
	pubDate = entry.data.pubDate;
	updatedDate = entry.data.updatedDate ?? null;
	heroImage = entry.data.heroImage ?? null;
}
---

<BlogPost
	title={title}
	description={description}
	pubDate={pubDate}
	updatedDate={updatedDate}
	heroImage={heroImage}
	contentHtml={contentHtml}
>
	{Content && <Content />}
</BlogPost>
